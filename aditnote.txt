Create necessary tables and database using command below

DROP TABLE IF EXISTS task;
DROP TABLE IF EXISTS created_group;
DROP TABLE IF EXISTS joined_group;
DROP TABLE IF EXISTS member;
DROP TABLE IF EXISTS groups;
DROP TABLE IF EXISTS reports;
DROP TABLE IF EXISTS session;
DROP TABLE IF EXISTS user;

CREATE TABLE user (
    user_id INT(11) NOT NULL AUTO_INCREMENT,
    username VARCHAR(30) NOT NULL,
    name VARCHAR(50) NOT NULL,
    type ENUM('guest', 'admin') NOT NULL DEFAULT 'guest',
    password_hash VARCHAR(255) NOT NULL,
    birth_date DATE DEFAULT NULL,
    joining_date DATE NOT NULL,
    phone_number VARCHAR(20) DEFAULT NULL,
    email VARCHAR(320) DEFAULT NULL,
    gender ENUM('M', 'F', 'Other') DEFAULT NULL,
    profession VARCHAR(100) DEFAULT NULL,
    PRIMARY KEY (user_id),
    UNIQUE KEY (username),
    UNIQUE KEY (phone_number),
    UNIQUE KEY (email),
    INDEX idx_username (username),
    INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE session (
    session_id CHAR(128) PRIMARY KEY,
    user_id INT NOT NULL,
    expire_time DATETIME NOT NULL,
    device_login_info VARCHAR(809) NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES user(user_id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_expire_time (expire_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE reports (
    report_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    subject VARCHAR(100) NOT NULL,
    details VARCHAR(1000) NOT NULL,
    file_extension VARCHAR(10) DEFAULT NULL,
    submission_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    status ENUM('pending', 'reviewed', 'resolved', 'dismissed') NOT NULL DEFAULT 'pending',
    FOREIGN KEY (user_id) REFERENCES user(user_id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_submission_date (submission_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE groups ( 
    group_id INT PRIMARY KEY AUTO_INCREMENT NOT NULL, 
    name VARCHAR(50) NOT NULL, 
    description VARCHAR(500),
    INDEX idx_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE member (
    membership_id INT PRIMARY KEY AUTO_INCREMENT,
    type ENUM('general', 'leader') DEFAULT 'general'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE joined_group ( 
    membership_id INT NOT NULL, 
    user_id INT NOT NULL,
    group_id INT NOT NULL, 
    joining_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (membership_id, group_id), 
    FOREIGN KEY (membership_id) REFERENCES member(membership_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES user(user_id) ON DELETE CASCADE,
    FOREIGN KEY (group_id) REFERENCES groups(group_id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_group_id (group_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE created_group ( 
    membership_id INT NOT NULL, 
    user_id INT NOT NULL,
    group_id INT NOT NULL, 
    creation_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (membership_id, group_id), 
    FOREIGN KEY (membership_id) REFERENCES member(membership_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES user(user_id) ON DELETE CASCADE,
    FOREIGN KEY (group_id) REFERENCES groups(group_id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_group_id (group_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE task ( 
    task_id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
    title VARCHAR(100) NOT NULL, 
    detail VARCHAR(500),
    status ENUM('todo', 'in_progress', 'done', 'dismissed') NOT NULL DEFAULT 'todo',
    type ENUM('personal', 'group') NOT NULL, 
    creation_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    deadline DATETIME DEFAULT NULL, 
    user_id INT,
    membership_id INT,
    FOREIGN KEY (user_id) REFERENCES user(user_id) ON DELETE CASCADE,
    FOREIGN KEY (membership_id) REFERENCES member(membership_id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_membership_id (membership_id),
    INDEX idx_status (status),
    INDEX idx_type (type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Note: This schema uses separate tables for joined_group and created_group
-- member table now includes group_id to properly link users to groups
-- Enforce in application logic:
-- - Personal tasks: user_id NOT NULL, membership_id NULL
-- - Group tasks: membership_id NOT NULL (user_id can be NULL or same as member's user_id)




Functions I have created:
    cookie_exist // takes no input and return true or false
    get_session_from_cookie // takes no input and return "Null" or <session_id of length 128> which is a string
    get_user_existence_and_id // takes the database connection object as input and return an array|| 0th index is True or False, 1th index is the user_id of the user if identified
    db_connection // takes no input and return database connection object
    set_cookie // send set cookie header to manage session



*** 
Copy paste this code to check if user is logged in or NOT. If user is logged in then you will get a variable named user_id, else user will automatically be redirected to the login page.
Remember to change the file path in include functions according to your file location:

<?php
include("../authentication/session_check.php");
include("../db_connection.php");

$conn = db_connection(); // Establish database connection

$user_data = get_user_existence_and_id($conn);
if ($user_data[0]) {
    $user_id = $user_data[1];
} else {
    header("Location: ../authentication/login.php");
    exit();
}
?>

***

